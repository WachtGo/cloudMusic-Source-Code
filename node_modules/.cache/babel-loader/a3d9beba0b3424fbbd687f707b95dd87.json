{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport QRCode from \"qrcode\";\nimport { getqrKey, getqrImg, getqrStatus } from \"@/api/login/login\";\nimport { getTimestamp, getQRCode } from \"@/api/commonApi\";\nexport default {\n  name: 'Login',\n  data: function data() {\n    return {\n      loginWrapShow: false,\n      qrStatus: '',\n      qrtimer: null\n    };\n  },\n  methods: {\n    goLogin: function goLogin() {\n      var _this = this;\n\n      this.loginWrapShow = true;\n      var params = {\n        timestamp: getTimestamp()\n      };\n      console.log(params.timestamp);\n      getqrKey(params).then(function (res) {\n        var params = {\n          key: res.data.data.unikey,\n          timestamp: getTimestamp()\n        };\n        getqrImg(params).then(function (res) {\n          console.log(res.data.data.qrurl);\n\n          _this.getQRCode(res.data.data.qrurl);\n\n          qrtimer = setInterval(function () {\n            getqrStatus(params).then(function (res) {\n              _this.qrStatus = res.data.message;\n\n              if (res.data.code === 803) {\n                _this.loginWrapShow = false;\n                clearInterval(qrtimer);\n              } else if (res.data.code === 800) {\n                _this.qrStatus += ',请刷新获取';\n              }\n            });\n          }, 1000);\n        });\n      });\n    },\n    //生成二维码\n    getQRCode: function getQRCode(qrurl) {\n      var opts = {\n        errorCorrectionLevel: \"H\",\n        //容错级别\n        type: \"image/png\",\n        //生成的二维码类型\n        quality: 0.3,\n        //二维码质量\n        margin: 10,\n        //二维码留白边距\n        width: 180,\n        //宽\n        height: 180,\n        //高\n        text: \"\",\n        //二维码内容\n        color: {\n          dark: \"#333333\",\n          //前景色\n          light: \"#fff\" //背景色\n\n        }\n      };\n      this.QRCodeMsg = qrurl; //生成的二维码为URL地址js\n\n      var msg = document.getElementById(\"QRCode_header\"); // 将获取到的数据（val）画到msg（canvas）上\n\n      QRCode.toCanvas(msg, this.QRCodeMsg, opts, function (error) {\n        console.log(error);\n      });\n    },\n    refreshQr: function refreshQr() {\n      this.goLogin();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;AAkBA;AACA;AACA;AACA;AACAA,eADA;AAEAC,MAFA,kBAEA;AACA;AACAC,0BADA;AAEAC,kBAFA;AAGAC;AAHA;AAKA,GARA;AASAC;AACAC,WADA,qBACA;AAAA;;AACA;AACA;AACAC;AADA;AAGAC;AACAC;AACA;AACAC,mCADA;AAEAH;AAFA;AAIAI;AACAH;;AACA;;AACAJ;AACAQ;AACA;;AACA;AACA;AACAC;AACA,eAHA,MAGA;AACA;AACA;AACA,aARA;AASA,WAVA,EAUA,IAVA;AAWA,SAdA;AAeA,OApBA;AAsBA,KA7BA;AA8BA;AACAC,aA/BA,qBA+BAC,KA/BA,EA+BA;AACA;AACAC,iCADA;AACA;AACAC,yBAFA;AAEA;AACAC,oBAHA;AAGA;AACAC,kBAJA;AAIA;AACAC,kBALA;AAKA;AACAC,mBANA;AAMA;AACAC,gBAPA;AAOA;AACAC;AACAC,yBADA;AACA;AACAC,uBAFA,CAEA;;AAFA;AARA;AAaA,6BAdA,CAcA;;AACA,yDAfA,CAgBA;;AACAC;AACAlB;AACA,OAFA;AAGA,KAnDA;AAoDAmB,aApDA,uBAoDA;AACA;AACA;AAtDA;AATA","names":["name","data","loginWrapShow","qrStatus","qrtimer","methods","goLogin","timestamp","console","getqrKey","key","getqrImg","getqrStatus","clearInterval","getQRCode","qrurl","errorCorrectionLevel","type","quality","margin","width","height","text","color","dark","light","QRCode","refreshQr"],"sourceRoot":"src/components/login","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"login\"\r\n         @click=\"goLogin\">登录</div>\r\n    <div class=\"loginWrap\"\r\n         v-if=\"loginWrapShow\">\r\n      <p @click=\"loginWrapShow = false\">关闭窗口</p>\r\n      <div class=\"imgWrap\">\r\n        <canvas id=\"QRCode_header\"></canvas>\r\n      </div>\r\n      <p class=\"refreshQr\"\r\n         v-if=\"qrStatus\"> <span @click='refreshQr'>刷新</span></p>\r\n      <p class=\"qrStatus\">{{qrStatus}}</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport QRCode from \"qrcode\"\r\nimport { getqrKey, getqrImg, getqrStatus } from \"@/api/login/login\"\r\nimport { getTimestamp, getQRCode } from \"@/api/commonApi\"\r\nexport default {\r\n  name: 'Login',\r\n  data () {\r\n    return {\r\n      loginWrapShow: false,\r\n      qrStatus: '',\r\n      qrtimer: null,\r\n    }\r\n  },\r\n  methods: {\r\n    goLogin () {\r\n      this.loginWrapShow = true\r\n      let params = {\r\n        timestamp: getTimestamp()\r\n      }\r\n      console.log(params.timestamp)\r\n      getqrKey(params).then((res) => {\r\n        let params = {\r\n          key: res.data.data.unikey,\r\n          timestamp: getTimestamp()\r\n        }\r\n        getqrImg(params).then((res) => {\r\n          console.log(res.data.data.qrurl)\r\n          this.getQRCode(res.data.data.qrurl)\r\n          qrtimer = setInterval(() => {\r\n            getqrStatus(params).then((res) => {\r\n              this.qrStatus = res.data.message\r\n              if (res.data.code === 803) {\r\n                this.loginWrapShow = false\r\n                clearInterval(qrtimer)\r\n              } else if (res.data.code === 800) {\r\n                this.qrStatus += ',请刷新获取'\r\n              }\r\n            })\r\n          }, 1000)\r\n        })\r\n      })\r\n\r\n    },\r\n    //生成二维码\r\n    getQRCode (qrurl) {\r\n      let opts = {\r\n        errorCorrectionLevel: \"H\",//容错级别\r\n        type: \"image/png\",//生成的二维码类型\r\n        quality: 0.3,//二维码质量\r\n        margin: 10,//二维码留白边距\r\n        width: 180,//宽\r\n        height: 180,//高\r\n        text: \"\",//二维码内容\r\n        color: {\r\n          dark: \"#333333\",//前景色\r\n          light: \"#fff\"//背景色\r\n        }\r\n      };\r\n      this.QRCodeMsg = qrurl; //生成的二维码为URL地址js\r\n      let msg = document.getElementById(\"QRCode_header\");\r\n      // 将获取到的数据（val）画到msg（canvas）上\r\n      QRCode.toCanvas(msg, this.QRCodeMsg, opts, function (error) {\r\n        console.log(error)\r\n      });\r\n    },\r\n    refreshQr () {\r\n      this.goLogin()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.login {\r\n  position: absolute;\r\n  right: 10px;\r\n  color: rgba(238, 238, 238, 0.61);\r\n  text-align: center;\r\n  // background: rgb(161, 145, 139);\r\n  &:hover {\r\n    cursor: pointer;\r\n    color: #eee;\r\n  }\r\n}\r\n.loginWrap {\r\n  z-index: 999;\r\n  position: fixed;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  margin: auto;\r\n  width: 500px;\r\n  height: 300px;\r\n  background-color: rgb(154, 176, 179);\r\n\r\n  .imgWrap {\r\n    // display: inline-block;\r\n    margin: 20px auto 0;\r\n    width: 180px;\r\n    height: 180px;\r\n    #QRCode_header {\r\n      margin: auto;\r\n    }\r\n  }\r\n  .qrStatus {\r\n    text-align: center;\r\n    // background-color: #eee;\r\n  }\r\n  .refreshQr {\r\n    color: rgba(255, 255, 255, 0.808);\r\n    margin-bottom: 20px;\r\n    text-align: center;\r\n    transition: 0.2s;\r\n    span {\r\n      &:hover {\r\n        color: rgb(228, 74, 74);\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}