{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport QRCode from \"qrcode\";\nimport { getqrKey, getqrImg, getqrStatus, getloginStatus, loginOut } from \"@/api/login\"; // import { mapMutations, mapState } from \"vuex\";\n// import { getuserDetail, getAccount } from \"@/api/user\";\n\nimport { cookieParser, getTimestamp } from \"@/utils/commonApi\";\nimport { getCookie, removeCookie, setCookie } from \"@/utils/cookie\";\nexport default {\n  name: \"Login\",\n\n  data() {\n    return {\n      loginWrapShow: false,\n      //展示登录窗口\n      qrStatus: \"\",\n      qrtimer: null,\n      key: \"\",\n      user: {\n        avatarUrl: \"\",\n        nickname: \"\",\n        userId: \"\",\n        userType: \"\"\n      },\n      loginStatus: false,\n      //登录状态\n      qrloading: false //点击判断是否已经授权时的加载图标状态\n\n    };\n  },\n\n  computed: {},\n\n  created() {\n    if (localStorage.getItem(\"user\")) {\n      this.user = JSON.parse(localStorage.getItem(\"user\"));\n    }\n\n    this.getloginStatus();\n  },\n\n  methods: {\n    goLogin() {\n      //点击登录，获取二维码\n      // this.loginWrapOnOff(true);\n      this.loginWrapShow = true;\n      this.refreshQr();\n    },\n\n    //生成二维码\n    getQRCode(qrurl) {\n      let opts = {\n        errorCorrectionLevel: \"H\",\n        //容错级别\n        type: \"image/png\",\n        //生成的二维码类型\n        quality: 0.3,\n        //二维码质量\n        margin: 5,\n        //二维码留白边距\n        width: 180,\n        //宽\n        height: 180,\n        //高\n        text: \"\",\n        //二维码内容\n        color: {\n          dark: \"#333333\",\n          //前景色\n          light: \"#fff\" //背景色\n\n        }\n      };\n      this.QRCodeMsg = qrurl; //生成的二维码为URL地址js\n\n      let msg = document.getElementById(\"QRCode_header\"); // 将获取到的数据（val）画到msg（canvas）上\n\n      QRCode.toCanvas(msg, qrurl, opts, function (error) {// console.log(error)\n      });\n    },\n\n    //  获取/刷新二维码\n    refreshQr() {\n      let params = {\n        timestamp: getTimestamp()\n      }; // console.log(params.timestamp)\n\n      getqrKey(params).then(async res => {\n        this.key = await res.data.data.unikey;\n        let params = {\n          key: res.data.data.unikey\n        };\n        getqrImg(params).then(res => {\n          this.getQRCode(res.data.data.qrurl);\n        });\n      });\n    },\n\n    // 二维码状态\n    getqrStatus() {\n      this.qrloading = true;\n      let params = {\n        key: this.key\n      };\n      getqrStatus(params).then(async res => {\n        this.qrStatus = await res.data.message;\n\n        if (res.data.code === 803) {\n          // clearInterval(this.qrtimer);\n          // console.log(\"扫码登录成功\");\n          let cookies = cookieParser(res.data.cookie);\n          setCookie(\"__csrf\", cookies[1]);\n          setTimeout(() => {\n            this.loginWrapShow = false; //关闭登录窗口\n\n            this.$message({\n              type: \"success\",\n              message: \"已登录\"\n            });\n          }, 500);\n          this.getloginStatus();\n        } else if (res.data.code === 800) {\n          this.qrStatus += \",请刷新获取\";\n        } else if (res.data.code === 400) {\n          this.qrStatus = \"请求错误\";\n        }\n\n        this.qrloading = false;\n      });\n    },\n\n    //获取登录状态\n    getloginStatus() {\n      getloginStatus().then(async res => {\n        // console.log(res.data.data.profile);\n        if (res.data.data.profile) {\n          this.loginStatus = true;\n          this.user = {\n            avatarUrl: res.data.data.profile.avatarUrl,\n            nickname: res.data.data.profile.nickname,\n            userId: res.data.data.profile.userId,\n            userType: res.data.data.profile.userType\n          }; // console.log(this.user);\n\n          localStorage.setItem(\"user\", JSON.stringify(this.user));\n        } else {\n          this.loginStatus = false;\n          localStorage.removeItem(\"user\");\n        }\n      });\n    },\n\n    //退出登录\n    loginOut() {\n      const loading = this.$loading({\n        background: \"rgba(255,255,255,0.1)\"\n      });\n      loginOut().then(res => {\n        this.$nextTick(() => {\n          loading.close();\n        });\n        this.loginStatus = false;\n        this.user = {};\n        localStorage.removeItem(\"user\");\n        this.$message.success(\"已退出登录\"); // this.getloginStatus(); //获取登陆状态\n      }).catch(err => {\n        this.$nextTick(() => {\n          loading.close();\n        });\n      });\n    },\n\n    golike() {\n      this.$router.push({\n        name: \"myPlayList\",\n        params: {\n          id: this.user.userId\n        }\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA,SACAA,QADA,EAEAC,QAFA,EAGAC,WAHA,EAIAC,cAJA,EAKAC,QALA,QAMA,aANA,C,CAOA;AACA;;AACA;AACA;AAEA;AACAC,eADA;;AAEAC;AACA;AACAC,0BADA;AACA;AACAC,kBAFA;AAGAC,mBAHA;AAIAC,aAJA;AAKAC;AACAC,qBADA;AAEAC,oBAFA;AAGAC,kBAHA;AAIAC;AAJA,OALA;AAWAC,wBAXA;AAWA;AACAC,sBAZA,CAYA;;AAZA;AAcA,GAjBA;;AAkBAC,cAlBA;;AAmBAC;AACA;AACA;AACA;;AACA;AACA,GAxBA;;AAyBAC;AACAC;AACA;AACA;AACA;AACA;AACA,KANA;;AAOA;AACAC;AACA;AACAC,iCADA;AACA;AACAC,yBAFA;AAEA;AACAC,oBAHA;AAGA;AACAC,iBAJA;AAIA;AACAC,kBALA;AAKA;AACAC,mBANA;AAMA;AACAC,gBAPA;AAOA;AACAC;AACAC,yBADA;AACA;AACAC,uBAFA,CAEA;;AAFA;AARA;AAaA,6BAdA,CAcA;;AACA,yDAfA,CAgBA;;AACAC,0DACA;AACA,OAFA;AAGA,KA5BA;;AA6BA;AACAC;AACA;AACAC;AADA,QADA,CAIA;;AACAnC;AACA;AACA;AACAU;AADA;AAGAT;AACA;AACA,SAFA;AAGA,OARA;AASA,KA5CA;;AA6CA;AACAC;AACA;AACA;AACAQ;AADA;AAGAR;AACA;;AACA;AACA;AACA;AACA;AACAkC;AACAC;AACA,uCADA,CACA;;AACA;AACAb,6BADA;AAEAc;AAFA;AAIA,WANA,EAMA,GANA;AAOA;AACA,SAbA,MAaA;AACA;AACA,SAFA,MAEA;AACA;AACA;;AACA;AACA,OArBA;AAsBA,KAzEA;;AA2EA;AACAnC;AACAA;AACA;AACA;AACA;AACA;AACAS,sDADA;AAEAC,oDAFA;AAGAC,gDAHA;AAIAC;AAJA,YAFA,CAQA;;AACAwB;AACA,SAVA,MAUA;AACA;AACAA;AACA;AACA,OAhBA;AAiBA,KA9FA;;AA+FA;AACAnC;AACA;AACAoC;AADA;AAGApC,iBACAqC,IADA,CACAC;AACA;AACAC;AACA,SAFA;AAGA;AACA;AACAJ;AACA,uCAPA,CAQA;AACA,OAVA,EAWAK,KAXA,CAWAC;AACA;AACAF;AACA,SAFA;AAGA,OAfA;AAgBA,KApHA;;AAqHAG;AACA;AACAzC,0BADA;AAEA0C;AACAC;AADA;AAFA;AAMA;;AA5HA;AAzBA","names":["getqrKey","getqrImg","getqrStatus","getloginStatus","loginOut","name","data","loginWrapShow","qrStatus","qrtimer","key","user","avatarUrl","nickname","userId","userType","loginStatus","qrloading","computed","created","methods","goLogin","getQRCode","errorCorrectionLevel","type","quality","margin","width","height","text","color","dark","light","QRCode","refreshQr","timestamp","setCookie","setTimeout","message","localStorage","background","then","res","loading","catch","err","golike","params","id"],"sourceRoot":"src/components/login","sources":["index.vue"],"sourcesContent":["<template>\r\n  <!-- 暂时开启该功能 -->\r\n  <div>\r\n    <div v-if=\"!loginStatus\" class=\"login\" @click=\"goLogin\">登录</div>\r\n    <div v-if=\"loginStatus\" class=\"user\">\r\n      <img class=\"userAvatar\" :src=\"user.avatarUrl\" alt=\"\" /><span\r\n        class=\"nickName\"\r\n        >{{ user.nickname }}</span\r\n      >\r\n      <ul>\r\n        <li class=\"logined-li\" @click=\"golike\">我的歌单</li>\r\n        <li class=\"logined-li\" @click=\"loginOut\">退出登录</li>\r\n      </ul>\r\n    </div>\r\n    <!-- <li class=\"logined-li\" @click=\"loginOut\">退出登录</li> -->\r\n    <!-- <el-button style=\"color: black\" @click=\"getloginStatus\"\r\n      >登录状态获取</el-button\r\n    >\r\n    <button @click=\"ceshi\">登录,测试</button>\r\n    <el-button style=\"color: black\" @click=\"getuserDetail\"\r\n      >获取用户详情</el-button\r\n    > -->\r\n    <!-- <el-button style=\"color: black\" @click=\"getAccount\">获取账号信息</el-button> -->\r\n    <div class=\"loginWrap\" v-show=\"loginWrapShow\">\r\n      <p class=\"loginClose\" @click=\"loginWrapShow = false\">\r\n        <i class=\"el-icon-close\"></i>\r\n      </p>\r\n      <div class=\"imgWrap\">\r\n        <canvas id=\"QRCode_header\"></canvas>\r\n      </div>\r\n      <p class=\"refreshQr\">\r\n        <span @click=\"refreshQr\">刷新二维码</span>\r\n      </p>\r\n      <p id=\"qrStatus\">\r\n        {{ qrStatus }}<i v-if=\"qrloading\" class=\"el-icon-loading\"></i>\r\n      </p>\r\n      <p\r\n        class=\"enter\"\r\n        @click=\"\r\n          getqrStatus();\r\n          qrloading = true;\r\n        \"\r\n      >\r\n        <span\r\n          >使用网易云音乐app进行扫码,可能会有所延迟,不用多次扫码,手动点击此处进入</span\r\n        >\r\n      </p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport QRCode from \"qrcode\";\r\nimport {\r\n  getqrKey,\r\n  getqrImg,\r\n  getqrStatus,\r\n  getloginStatus,\r\n  loginOut,\r\n} from \"@/api/login\";\r\n// import { mapMutations, mapState } from \"vuex\";\r\n// import { getuserDetail, getAccount } from \"@/api/user\";\r\nimport { cookieParser, getTimestamp } from \"@/utils/commonApi\";\r\nimport { getCookie, removeCookie, setCookie } from \"@/utils/cookie\";\r\n\r\nexport default {\r\n  name: \"Login\",\r\n  data() {\r\n    return {\r\n      loginWrapShow: false, //展示登录窗口\r\n      qrStatus: \"\",\r\n      qrtimer: null,\r\n      key: \"\",\r\n      user: {\r\n        avatarUrl: \"\",\r\n        nickname: \"\",\r\n        userId: \"\",\r\n        userType: \"\",\r\n      },\r\n      loginStatus: false, //登录状态\r\n      qrloading: false, //点击判断是否已经授权时的加载图标状态\r\n    };\r\n  },\r\n  computed: {},\r\n  created() {\r\n    if (localStorage.getItem(\"user\")) {\r\n      this.user = JSON.parse(localStorage.getItem(\"user\"));\r\n    }\r\n    this.getloginStatus();\r\n  },\r\n  methods: {\r\n    goLogin() {\r\n      //点击登录，获取二维码\r\n      // this.loginWrapOnOff(true);\r\n      this.loginWrapShow = true;\r\n      this.refreshQr();\r\n    },\r\n    //生成二维码\r\n    getQRCode(qrurl) {\r\n      let opts = {\r\n        errorCorrectionLevel: \"H\", //容错级别\r\n        type: \"image/png\", //生成的二维码类型\r\n        quality: 0.3, //二维码质量\r\n        margin: 5, //二维码留白边距\r\n        width: 180, //宽\r\n        height: 180, //高\r\n        text: \"\", //二维码内容\r\n        color: {\r\n          dark: \"#333333\", //前景色\r\n          light: \"#fff\", //背景色\r\n        },\r\n      };\r\n      this.QRCodeMsg = qrurl; //生成的二维码为URL地址js\r\n      let msg = document.getElementById(\"QRCode_header\");\r\n      // 将获取到的数据（val）画到msg（canvas）上\r\n      QRCode.toCanvas(msg, qrurl, opts, function (error) {\r\n        // console.log(error)\r\n      });\r\n    },\r\n    //  获取/刷新二维码\r\n    refreshQr() {\r\n      let params = {\r\n        timestamp: getTimestamp(),\r\n      };\r\n      // console.log(params.timestamp)\r\n      getqrKey(params).then(async (res) => {\r\n        this.key = await res.data.data.unikey;\r\n        let params = {\r\n          key: res.data.data.unikey,\r\n        };\r\n        getqrImg(params).then((res) => {\r\n          this.getQRCode(res.data.data.qrurl);\r\n        });\r\n      });\r\n    },\r\n    // 二维码状态\r\n    getqrStatus() {\r\n      this.qrloading = true;\r\n      let params = {\r\n        key: this.key,\r\n      };\r\n      getqrStatus(params).then(async (res) => {\r\n        this.qrStatus = await res.data.message;\r\n        if (res.data.code === 803) {\r\n          // clearInterval(this.qrtimer);\r\n          // console.log(\"扫码登录成功\");\r\n          let cookies = cookieParser(res.data.cookie);\r\n          setCookie(\"__csrf\", cookies[1]);\r\n          setTimeout(() => {\r\n            this.loginWrapShow = false; //关闭登录窗口\r\n            this.$message({\r\n              type: \"success\",\r\n              message: \"已登录\",\r\n            });\r\n          }, 500);\r\n          this.getloginStatus();\r\n        } else if (res.data.code === 800) {\r\n          this.qrStatus += \",请刷新获取\";\r\n        } else if (res.data.code === 400) {\r\n          this.qrStatus = \"请求错误\";\r\n        }\r\n        this.qrloading = false;\r\n      });\r\n    },\r\n\r\n    //获取登录状态\r\n    getloginStatus() {\r\n      getloginStatus().then(async (res) => {\r\n        // console.log(res.data.data.profile);\r\n        if (res.data.data.profile) {\r\n          this.loginStatus = true;\r\n          this.user = {\r\n            avatarUrl: res.data.data.profile.avatarUrl,\r\n            nickname: res.data.data.profile.nickname,\r\n            userId: res.data.data.profile.userId,\r\n            userType: res.data.data.profile.userType,\r\n          };\r\n          // console.log(this.user);\r\n          localStorage.setItem(\"user\", JSON.stringify(this.user));\r\n        } else {\r\n          this.loginStatus = false;\r\n          localStorage.removeItem(\"user\");\r\n        }\r\n      });\r\n    },\r\n    //退出登录\r\n    loginOut() {\r\n      const loading = this.$loading({\r\n        background: \"rgba(255,255,255,0.1)\",\r\n      });\r\n      loginOut()\r\n        .then((res) => {\r\n          this.$nextTick(() => {\r\n            loading.close();\r\n          });\r\n          this.loginStatus = false;\r\n          this.user = {};\r\n          localStorage.removeItem(\"user\");\r\n          this.$message.success(\"已退出登录\");\r\n          // this.getloginStatus(); //获取登陆状态\r\n        })\r\n        .catch((err) => {\r\n          this.$nextTick(() => {\r\n            loading.close();\r\n          });\r\n        });\r\n    },\r\n    golike() {\r\n      this.$router.push({\r\n        name: \"myPlayList\",\r\n        params: {\r\n          id: this.user.userId,\r\n        },\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.login,\r\n.user {\r\n  position: absolute;\r\n  // width: 150px;\r\n  height: 30px;\r\n  top: 0;\r\n  right: 10px;\r\n  color: rgba(238, 238, 238, 0.61);\r\n  text-align: center;\r\n  overflow: hidden;\r\n  transition: 0.2s;\r\n  // background: rgb(161, 145, 139);\r\n  &:hover {\r\n    height: 96px; //每次添加一个列表这里加32px\r\n    transform: scale(1.01);\r\n  }\r\n\r\n  .userAvatar {\r\n    vertical-align: top;\r\n    margin-right: 10px;\r\n    width: 28px;\r\n    height: 28px;\r\n    border-radius: 50%;\r\n  }\r\n  .nickName {\r\n    display: inline-block;\r\n    font-size: 13px;\r\n    height: 30px;\r\n    line-height: 30px;\r\n  }\r\n  .logined-li {\r\n    height: 32px;\r\n    line-height: 32px;\r\n    font-size: 13px;\r\n    transition: 0.2s;\r\n    padding: 0 10px;\r\n    background: rgba(160, 160, 160, 0.041);\r\n\r\n    &:hover {\r\n      cursor: pointer;\r\n      color: rgb(39, 177, 131);\r\n      transform: scale(1.01);\r\n    }\r\n  }\r\n}\r\n.login {\r\n  &:hover {\r\n    cursor: pointer;\r\n    color: rgb(187, 145, 90);\r\n  }\r\n}\r\n.loginWrap {\r\n  z-index: 999;\r\n  position: fixed;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  margin: auto;\r\n  width: 500px;\r\n  height: 300px;\r\n  border-radius: 15px;\r\n  background: url(@/static/img/background8.jpeg);\r\n\r\n  .loginClose {\r\n    position: absolute;\r\n    height: 20px;\r\n    top: 15px;\r\n    right: 15px;\r\n\r\n    color: rgb(221, 191, 151);\r\n    transition: 0.2s;\r\n    /deep/ .el-icon-close {\r\n      font-size: 20px;\r\n\r\n      &:hover {\r\n        cursor: pointer;\r\n        color: rgb(187, 145, 90);\r\n      }\r\n    }\r\n  }\r\n  .imgWrap {\r\n    // display: inline-block;\r\n    margin: 45px auto 0;\r\n    width: 180px;\r\n    height: 180px;\r\n    #QRCode_header {\r\n      margin: auto;\r\n    }\r\n  }\r\n  #qrStatus {\r\n    color: #eee;\r\n    text-align: center;\r\n    // background-color: #eee;\r\n  }\r\n  .refreshQr {\r\n    padding: 5px;\r\n    color: rgba(255, 255, 255, 0.808);\r\n\r\n    text-align: center;\r\n    transition: 0.2s;\r\n    span {\r\n      font-size: 15px;\r\n      transition: 0.2s;\r\n      &:hover {\r\n        color: rgba(221, 191, 152);\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  }\r\n  .enter {\r\n    position: absolute;\r\n    bottom: 5px;\r\n    right: 5px;\r\n    font-size: 14px;\r\n    color: rgba(221, 191, 152, 0.788);\r\n    transition: 0.2s;\r\n    &:hover {\r\n      color: rgba(221, 191, 152);\r\n      cursor: pointer;\r\n    }\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}